<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>spynnaker.pyNN.models.pynn_population_common &#8212; sPyNNaker  documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">sPyNNaker  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for spynnaker.pyNN.models.pynn_population_common</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (c) 2017-2019 The University of Manchester</span>
<span class="c1">#</span>
<span class="c1"># This program is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">six</span> <span class="kn">import</span> <span class="n">string_types</span><span class="p">,</span> <span class="n">iteritems</span>
<span class="kn">from</span> <span class="nn">spinn_utilities.logger_utils</span> <span class="kn">import</span> <span class="n">warn_once</span>
<span class="kn">from</span> <span class="nn">spinn_utilities.log</span> <span class="kn">import</span> <span class="n">FormatAdapter</span>
<span class="kn">from</span> <span class="nn">pacman.model.constraints</span> <span class="kn">import</span> <span class="n">AbstractConstraint</span>
<span class="kn">from</span> <span class="nn">pacman.model.constraints.placer_constraints</span> <span class="kn">import</span> <span class="n">ChipAndCoreConstraint</span>
<span class="kn">from</span> <span class="nn">pacman.model.constraints.partitioner_constraints</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">MaxVertexAtomsConstraint</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pacman.model.graphs.application.application_vertex</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ApplicationVertex</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.utilities</span> <span class="kn">import</span> <span class="n">globals_variables</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.utilities.exceptions</span> <span class="kn">import</span> <span class="n">ConfigurationException</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.abstract_models</span> <span class="kn">import</span> <span class="n">AbstractChangableAfterRun</span>
<span class="kn">from</span> <span class="nn">spynnaker.pyNN.models.abstract_models</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">AbstractReadParametersBeforeSet</span><span class="p">,</span> <span class="n">AbstractContainsUnits</span><span class="p">,</span>
    <span class="n">AbstractPopulationInitializable</span><span class="p">,</span> <span class="n">AbstractPopulationSettable</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">.abstract_pynn_model</span> <span class="kn">import</span> <span class="n">AbstractPyNNModel</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">FormatAdapter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_we_dont_do_this_now</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>  <span class="c1"># pylint: disable=unused-argument</span>
    <span class="c1"># pragma: no cover</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;sPyNNaker8 does not currently do this&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="PyNNPopulationCommon"><a class="viewcode-back" href="../../../../spynnaker.pyNN.models.html#spynnaker.pyNN.models.pynn_population_common.PyNNPopulationCommon">[docs]</a><span class="k">class</span> <span class="nc">PyNNPopulationCommon</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;_all_ids&quot;</span><span class="p">,</span>
        <span class="s2">&quot;__change_requires_mapping&quot;</span><span class="p">,</span>
        <span class="s2">&quot;__delay_vertex&quot;</span><span class="p">,</span>
        <span class="s2">&quot;__first_id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;__has_read_neuron_parameters_this_run&quot;</span><span class="p">,</span>
        <span class="s2">&quot;__last_id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_positions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;__record_gsyn_file&quot;</span><span class="p">,</span>
        <span class="s2">&quot;__record_spike_file&quot;</span><span class="p">,</span>
        <span class="s2">&quot;__record_v_file&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_size&quot;</span><span class="p">,</span>
        <span class="s2">&quot;__spinnaker_control&quot;</span><span class="p">,</span>
        <span class="s2">&quot;__structure&quot;</span><span class="p">,</span>
        <span class="s2">&quot;__vertex&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_vertex_changeable_after_run&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_vertex_contains_units&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_vertex_population_initializable&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_vertex_population_settable&quot;</span><span class="p">,</span>
        <span class="s2">&quot;_vertex_read_parameters_before_set&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">spinnaker_control</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">constraints</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span>
            <span class="n">structure</span><span class="p">,</span> <span class="n">initial_values</span><span class="p">,</span> <span class="n">additional_parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># pylint: disable=too-many-arguments</span>
        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_roundsize</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>

        <span class="c1"># Use a provided model to create a vertex</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">AbstractPyNNModel</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">size</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                    <span class="s2">&quot;A population cannot have a negative or zero size.&quot;</span><span class="p">)</span>
            <span class="n">population_parameters</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">default_population_parameters</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">additional_parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">population_parameters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">additional_parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">create_vertex</span><span class="p">(</span>
                <span class="n">size</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">constraints</span><span class="p">,</span> <span class="o">**</span><span class="n">population_parameters</span><span class="p">)</span>

        <span class="c1"># Use a provided application vertex directly</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">ApplicationVertex</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">additional_parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                    <span class="s2">&quot;Cannot accept additional parameters </span><span class="si">{}</span><span class="s2"> when the cell is&quot;</span>
                    <span class="s2">&quot; a vertex&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">additional_parameters</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span> <span class="o">=</span> <span class="n">model</span>
            <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span><span class="o">.</span><span class="n">n_atoms</span>
            <span class="k">elif</span> <span class="n">size</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span><span class="o">.</span><span class="n">n_atoms</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                    <span class="s2">&quot;Vertex size does not match Population size&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">constraints</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span><span class="o">.</span><span class="n">add_constraints</span><span class="p">(</span><span class="n">constraints</span><span class="p">)</span>

        <span class="c1"># Fail on anything else</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                <span class="s2">&quot;Model must be either an AbstractPyNNModel or an&quot;</span>
                <span class="s2">&quot; ApplicationVertex&quot;</span><span class="p">)</span>

        <span class="c1"># Introspect properties of the vertex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vertex_population_settable</span> <span class="o">=</span> \
            <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span><span class="p">,</span> <span class="n">AbstractPopulationSettable</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vertex_population_initializable</span> <span class="o">=</span> \
            <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span><span class="p">,</span> <span class="n">AbstractPopulationInitializable</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vertex_changeable_after_run</span> <span class="o">=</span> \
            <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span><span class="p">,</span> <span class="n">AbstractChangableAfterRun</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vertex_read_parameters_before_set</span> <span class="o">=</span> \
            <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span><span class="p">,</span> <span class="n">AbstractReadParametersBeforeSet</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vertex_contains_units</span> <span class="o">=</span> \
            <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span><span class="p">,</span> <span class="n">AbstractContainsUnits</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__spinnaker_control</span> <span class="o">=</span> <span class="n">spinnaker_control</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__delay_vertex</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Internal structure now supported 23 November 2014 ADR</span>
        <span class="c1"># structure should be a valid Space.py structure type.</span>
        <span class="c1"># generation of positions is deferred until needed.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__structure</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_positions</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># add objects to the SpiNNaker control class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__spinnaker_control</span><span class="o">.</span><span class="n">add_population</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__spinnaker_control</span><span class="o">.</span><span class="n">add_application_vertex</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span><span class="p">)</span>

        <span class="c1"># initialise common stuff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__record_spike_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__record_v_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__record_gsyn_file</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># parameter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__change_requires_mapping</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__has_read_neuron_parameters_this_run</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># things for pynn demands</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_ids</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="n">globals_variables</span><span class="o">.</span><span class="n">get_simulator</span><span class="p">()</span><span class="o">.</span><span class="n">id_counter</span><span class="p">,</span>
            <span class="n">globals_variables</span><span class="o">.</span><span class="n">get_simulator</span><span class="p">()</span><span class="o">.</span><span class="n">id_counter</span> <span class="o">+</span> <span class="n">size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__first_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__last_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_ids</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># update the simulators id_counter for giving a unique ID for every</span>
        <span class="c1"># atom</span>
        <span class="n">globals_variables</span><span class="o">.</span><span class="n">get_simulator</span><span class="p">()</span><span class="o">.</span><span class="n">id_counter</span> <span class="o">+=</span> <span class="n">size</span>

        <span class="c1"># set up initial values if given</span>
        <span class="k">if</span> <span class="n">initial_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">variable</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">initial_values</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_initialize</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">first_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__first_id</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">last_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__last_id</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__structure</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_vertex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">requires_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__change_requires_mapping</span>

    <span class="nd">@requires_mapping</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">requires_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__change_requires_mapping</span> <span class="o">=</span> <span class="n">new_value</span>

<div class="viewcode-block" id="PyNNPopulationCommon.mark_no_changes"><a class="viewcode-back" href="../../../../spynnaker.pyNN.models.html#spynnaker.pyNN.models.pynn_population_common.PyNNPopulationCommon.mark_no_changes">[docs]</a>    <span class="k">def</span> <span class="nf">mark_no_changes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__change_requires_mapping</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__has_read_neuron_parameters_this_run</span> <span class="o">=</span> <span class="kc">False</span></div>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Merges populations</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: Make this add the neurons from another population to this one</span>
        <span class="n">_we_dont_do_this_now</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">conductance_based</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; True if the population uses conductance inputs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span><span class="p">,</span> <span class="s2">&quot;conductance_based&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span><span class="o">.</span><span class="n">conductance_based</span>
        <span class="k">return</span> <span class="kc">False</span>

<div class="viewcode-block" id="PyNNPopulationCommon.get"><a class="viewcode-back" href="../../../../spynnaker.pyNN.models.html#spynnaker.pyNN.models.pynn_population_common.PyNNPopulationCommon.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter_names</span><span class="p">,</span> <span class="n">gather</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">simplify</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get the values of a parameter for every local cell in the\</span>
<span class="sd">            population.</span>

<span class="sd">        :param parameter_names: Name of parameter. This is either a single\</span>
<span class="sd">            string or a list of strings</span>
<span class="sd">        :param gather: pointless on sPyNNaker</span>
<span class="sd">        :return: A single list of values (or possibly a single value) if\</span>
<span class="sd">            paramter_names is a string, or a dict of these if parameter names\</span>
<span class="sd">            is a list.</span>
<span class="sd">        :rtype: str or list(str) or dict(str,str) or dict(str,list(str))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">gather</span><span class="p">:</span>
            <span class="n">warn_once</span><span class="p">(</span>
                <span class="n">logger</span><span class="p">,</span> <span class="s2">&quot;sPyNNaker only supports gather=True. We will run &quot;</span>
                <span class="s2">&quot;as if gather was set to True.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">simplify</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">warn_once</span><span class="p">(</span>
                <span class="n">logger</span><span class="p">,</span> <span class="s2">&quot;The simplify value is ignored if not set to true&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vertex_population_settable</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Population does not support setting&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parameter_names</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">parameter_names</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">parameter_name</span> <span class="ow">in</span> <span class="n">parameter_names</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">parameter_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">parameter_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span></div>

    <span class="c1"># NON-PYNN API CALL</span>
<div class="viewcode-block" id="PyNNPopulationCommon.get_by_selector"><a class="viewcode-back" href="../../../../spynnaker.pyNN.models.html#spynnaker.pyNN.models.pynn_population_common.PyNNPopulationCommon.get_by_selector">[docs]</a>    <span class="k">def</span> <span class="nf">get_by_selector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">,</span> <span class="n">parameter_names</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get the values of a parameter for the selected cell in the\</span>
<span class="sd">            population.</span>

<span class="sd">        :param parameter_names: Name of parameter. This is either a\</span>
<span class="sd">            single string or a list of strings</span>
<span class="sd">        :param selector: a description of the subrange to accept. \</span>
<span class="sd">            Or None for all. \</span>
<span class="sd">            See: _selector_to_ids in \</span>
<span class="sd">            SpiNNUtils.spinn_utilities.ranged.abstract_sized.py</span>
<span class="sd">        :return: A single list of values (or possibly a single value) if\</span>
<span class="sd">            paramter_names is a string or a dict of these if parameter names\</span>
<span class="sd">            is a list.</span>
<span class="sd">        :rtype: str or list(str) or dict(str,str) or dict(str,list(str))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vertex_population_settable</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Population does not support setting&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parameter_names</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span><span class="o">.</span><span class="n">get_value_by_selector</span><span class="p">(</span>
                <span class="n">selector</span><span class="p">,</span> <span class="n">parameter_names</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">parameter_name</span> <span class="ow">in</span> <span class="n">parameter_names</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">parameter_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span><span class="o">.</span><span class="n">get_value_by_selector</span><span class="p">(</span>
                <span class="n">selector</span><span class="p">,</span> <span class="n">parameter_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="PyNNPopulationCommon.id_to_index"><a class="viewcode-back" href="../../../../spynnaker.pyNN.models.html#spynnaker.pyNN.models.pynn_population_common.PyNNPopulationCommon.id_to_index">[docs]</a>    <span class="k">def</span> <span class="nf">id_to_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>  <span class="c1"># @ReservedAssignment</span>
        <span class="sd">&quot;&quot;&quot; Given the ID(s) of cell(s) in the Population, return its (their)\</span>
<span class="sd">            index (order in the Population).</span>

<span class="sd">        Defined by</span>
<span class="sd">        http://neuralensemble.org/docs/PyNN/reference/populations.html</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># pylint: disable=redefined-builtin</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">iterable</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__first_id</span> <span class="o">&lt;=</span> <span class="nb">id</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__last_id</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;id should be in the range [</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">], actually </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__first_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__last_id</span><span class="p">,</span> <span class="nb">id</span><span class="p">))</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">id</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__first_id</span><span class="p">)</span>  <span class="c1"># assume IDs are consecutive</span>
        <span class="k">return</span> <span class="nb">id</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__first_id</span></div>

<div class="viewcode-block" id="PyNNPopulationCommon.index_to_id"><a class="viewcode-back" href="../../../../spynnaker.pyNN.models.html#spynnaker.pyNN.models.pynn_population_common.PyNNPopulationCommon.index_to_id">[docs]</a>    <span class="k">def</span> <span class="nf">index_to_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Given the index (order in the Population) of cell(s) in the\</span>
<span class="sd">            Population, return their ID(s)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">iterable</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__last_id</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__first_id</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;indexes should be in the range [</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">], actually </span><span class="si">{}</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__last_id</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__first_id</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__first_id</span><span class="p">)</span>
        <span class="c1"># this assumes IDs are consecutive</span>
        <span class="k">return</span> <span class="n">index</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__first_id</span></div>

<div class="viewcode-block" id="PyNNPopulationCommon.id_to_local_index"><a class="viewcode-back" href="../../../../spynnaker.pyNN.models.html#spynnaker.pyNN.models.pynn_population_common.PyNNPopulationCommon.id_to_local_index">[docs]</a>    <span class="k">def</span> <span class="nf">id_to_local_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Given the ID(s) of cell(s) in the Population, return its (their)\</span>
<span class="sd">            index (order in the Population), counting only cells on the local\</span>
<span class="sd">            MPI node.</span>
<span class="sd">        Defined by</span>
<span class="sd">        http://neuralensemble.org/docs/PyNN/reference/populations.html</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: Need __getitem__</span>
        <span class="n">_we_dont_do_this_now</span><span class="p">(</span><span class="n">cell_id</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the initial value of one of the state variables of the neurons\</span>
<span class="sd">            in this population.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vertex_population_initializable</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                <span class="s2">&quot;Population does not support the initialisation of </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">variable</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">globals_variables</span><span class="o">.</span><span class="n">get_not_running_simulator</span><span class="p">()</span><span class="o">.</span><span class="n">has_ran</span> \
                <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vertex_changeable_after_run</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Population does not support changes after run&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read_parameters_before_set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<div class="viewcode-block" id="PyNNPopulationCommon.inject"><a class="viewcode-back" href="../../../../spynnaker.pyNN.models.html#spynnaker.pyNN.models.pynn_population_common.PyNNPopulationCommon.inject">[docs]</a>    <span class="k">def</span> <span class="nf">inject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_source</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Connect a current source to all cells in the Population.</span>

<span class="sd">        Defined by</span>
<span class="sd">        http://neuralensemble.org/docs/PyNN/reference/populations.html</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># TODO:</span>
        <span class="n">_we_dont_do_this_now</span><span class="p">(</span><span class="n">current_source</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get the total number of cells in the population.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The label of the population</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vertex</span><span class="o">.</span><span class="n">label</span>

    <span class="nd">@label</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;As label is used as an ID it can not be changed&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">local_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The number of local cells</span>

<span class="sd">        Defined by</span>
<span class="sd">        http://neuralensemble.org/docs/PyNN/reference/populations.html</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Doesn&#39;t make much sense on SpiNNaker</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span>

    <span class="k">def</span> <span class="nf">_set_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Checks for various set methods.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vertex_population_settable</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Population does not have property </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">parameter</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">globals_variables</span><span class="o">.</span><span class="n">get_not_running_simulator</span><span class="p">()</span><span class="o">.</span><span class="n">has_ran</span> \
                <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vertex_changeable_after_run</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot; run has been called&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;A value (not None) must be specified&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameter</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Parameter must either be the name of a single parameter to&quot;</span>
                <span class="s2">&quot; set, or a dict of parameter: value items to set&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_read_parameters_before_set</span><span class="p">()</span>

<div class="viewcode-block" id="PyNNPopulationCommon.set"><a class="viewcode-back" href="../../../../spynnaker.pyNN.models.html#spynnaker.pyNN.models.pynn_population_common.PyNNPopulationCommon.set">[docs]</a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set one or more parameters for every cell in the population.</span>

<span class="sd">        param can be a dict, in which case value should not be supplied, or a\</span>
<span class="sd">        string giving the parameter name, in which case value is the parameter\</span>
<span class="sd">        value. value can be a numeric value, or list of such\</span>
<span class="sd">        (e.g. for setting spike times)::</span>

<span class="sd">            p.set(&quot;tau_m&quot;, 20.0).</span>
<span class="sd">            p.set({&#39;tau_m&#39;:20, &#39;v_rest&#39;:-65})</span>

<span class="sd">        :param parameter: the parameter to set</span>
<span class="sd">        :type parameter: str or dict</span>
<span class="sd">        :param value: the value of the parameter to set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_check</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="c1"># set new parameters</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;A value (not None) must be specified&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">parameter</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

    <span class="c1"># NON-PYNN API CALL</span>
<div class="viewcode-block" id="PyNNPopulationCommon.set_by_selector"><a class="viewcode-back" href="../../../../spynnaker.pyNN.models.html#spynnaker.pyNN.models.pynn_population_common.PyNNPopulationCommon.set_by_selector">[docs]</a>    <span class="k">def</span> <span class="nf">set_by_selector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">,</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set one or more parameters for selected cell in the population.</span>

<span class="sd">        param can be a dict, in which case value should not be supplied, or a\</span>
<span class="sd">        string giving the parameter name, in which case value is the parameter\</span>
<span class="sd">        value. value can be a numeric value, or list of such</span>
<span class="sd">        (e.g. for setting spike times)::</span>

<span class="sd">            p.set(&quot;tau_m&quot;, 20.0).</span>
<span class="sd">            p.set({&#39;tau_m&#39;:20, &#39;v_rest&#39;:-65})</span>

<span class="sd">        :param selector: See RangedList.set_value_by_selector as this is just \</span>
<span class="sd">            a pass through method</span>
<span class="sd">        :param parameter: the parameter to set</span>
<span class="sd">        :param value: the value of the parameter to set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_check</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="c1"># set new parameters</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameter</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span><span class="o">.</span><span class="n">set_value_by_selector</span><span class="p">(</span><span class="n">selector</span><span class="p">,</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">parameter</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span><span class="o">.</span><span class="n">set_value_by_selector</span><span class="p">(</span><span class="n">selector</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_read_parameters_before_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Reads parameters from the machine before &quot;set&quot; completes</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># If the tools have run before, and not reset, and the read</span>
        <span class="c1"># hasn&#39;t already been done, read back the data</span>
        <span class="k">if</span> <span class="n">globals_variables</span><span class="o">.</span><span class="n">get_simulator</span><span class="p">()</span><span class="o">.</span><span class="n">has_ran</span> \
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vertex_read_parameters_before_set</span> \
                <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__has_read_neuron_parameters_this_run</span> \
                <span class="ow">and</span> <span class="ow">not</span> <span class="n">globals_variables</span><span class="o">.</span><span class="n">get_simulator</span><span class="p">()</span><span class="o">.</span><span class="n">use_virtual_board</span><span class="p">:</span>
            <span class="c1"># locate machine vertices from the application vertices</span>
            <span class="n">machine_vertices</span> <span class="o">=</span> <span class="n">globals_variables</span><span class="o">.</span><span class="n">get_simulator</span><span class="p">()</span><span class="o">.</span><span class="n">graph_mapper</span>\
                <span class="o">.</span><span class="n">get_machine_vertices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span><span class="p">)</span>

            <span class="c1"># go through each machine vertex and read the neuron parameters</span>
            <span class="c1"># it contains</span>
            <span class="k">for</span> <span class="n">machine_vertex</span> <span class="ow">in</span> <span class="n">machine_vertices</span><span class="p">:</span>

                <span class="c1"># tell the core to rewrite neuron params back to the</span>
                <span class="c1"># SDRAM space.</span>
                <span class="n">placement</span> <span class="o">=</span> <span class="n">globals_variables</span><span class="o">.</span><span class="n">get_simulator</span><span class="p">()</span><span class="o">.</span><span class="n">placements</span><span class="o">.</span>\
                    <span class="n">get_placement_of_vertex</span><span class="p">(</span><span class="n">machine_vertex</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span><span class="o">.</span><span class="n">read_parameters_from_machine</span><span class="p">(</span>
                    <span class="n">globals_variables</span><span class="o">.</span><span class="n">get_simulator</span><span class="p">()</span><span class="o">.</span><span class="n">transceiver</span><span class="p">,</span> <span class="n">placement</span><span class="p">,</span>
                    <span class="n">globals_variables</span><span class="o">.</span><span class="n">get_simulator</span><span class="p">()</span><span class="o">.</span><span class="n">graph_mapper</span><span class="o">.</span><span class="n">get_slice</span><span class="p">(</span>
                        <span class="n">machine_vertex</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">__has_read_neuron_parameters_this_run</span> <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="PyNNPopulationCommon.get_spike_counts"><a class="viewcode-back" href="../../../../spynnaker.pyNN.models.html#spynnaker.pyNN.models.pynn_population_common.PyNNPopulationCommon.get_spike_counts">[docs]</a>    <span class="k">def</span> <span class="nf">get_spike_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spikes</span><span class="p">,</span> <span class="n">gather</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the number of spikes for each neuron.</span>

<span class="sd">        Defined by</span>
<span class="sd">        http://neuralensemble.org/docs/PyNN/reference/populations.html</span>

<span class="sd">        :param gather: pointless on sPyNNaker</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">gather</span><span class="p">:</span>
            <span class="n">warn_once</span><span class="p">(</span>
                <span class="n">logger</span><span class="p">,</span> <span class="s2">&quot;sPyNNaker only supports gather=True. We will run &quot;</span>
                <span class="s2">&quot;as if gather was set to True.&quot;</span><span class="p">)</span>
        <span class="n">n_spikes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">spikes</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
                                <span class="n">minlength</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span><span class="o">.</span><span class="n">n_atoms</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span><span class="o">.</span><span class="n">n_atoms</span><span class="p">):</span>
            <span class="n">n_spikes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">n_spikes</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">positions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the position array for structured populations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_positions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__structure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;attempted to retrieve positions &quot;</span>
                                 <span class="s2">&quot;for an unstructured population&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__structure</span><span class="o">.</span><span class="n">generate_positions</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span><span class="o">.</span><span class="n">n_atoms</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_positions</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the structure for the population.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__structure</span>

    <span class="c1"># NON-PYNN API CALL</span>
<div class="viewcode-block" id="PyNNPopulationCommon.set_constraint"><a class="viewcode-back" href="../../../../spynnaker.pyNN.models.html#spynnaker.pyNN.models.pynn_population_common.PyNNPopulationCommon.set_constraint">[docs]</a>    <span class="k">def</span> <span class="nf">set_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constraint</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Apply a constraint to a population that restricts the processor\</span>
<span class="sd">            onto which its atoms will be placed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">globals_variables</span><span class="o">.</span><span class="n">get_simulator</span><span class="p">()</span><span class="o">.</span><span class="n">verify_not_running</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">constraint</span><span class="p">,</span> <span class="n">AbstractConstraint</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                <span class="s2">&quot;the constraint entered is not a recognised constraint&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">constraint</span><span class="p">)</span>
        <span class="c1"># state that something has changed in the population,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__change_requires_mapping</span> <span class="o">=</span> <span class="kc">True</span></div>

    <span class="c1"># NON-PYNN API CALL</span>
<div class="viewcode-block" id="PyNNPopulationCommon.add_placement_constraint"><a class="viewcode-back" href="../../../../spynnaker.pyNN.models.html#spynnaker.pyNN.models.pynn_population_common.PyNNPopulationCommon.add_placement_constraint">[docs]</a>    <span class="k">def</span> <span class="nf">add_placement_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add a placement constraint</span>

<span class="sd">        :param x: The x-coordinate of the placement constraint</span>
<span class="sd">        :type x: int</span>
<span class="sd">        :param y: The y-coordinate of the placement constraint</span>
<span class="sd">        :type y: int</span>
<span class="sd">        :param p: The processor ID of the placement constraint (optional)</span>
<span class="sd">        :type p: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">globals_variables</span><span class="o">.</span><span class="n">get_simulator</span><span class="p">()</span><span class="o">.</span><span class="n">verify_not_running</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">ChipAndCoreConstraint</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>

        <span class="c1"># state that something has changed in the population,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__change_requires_mapping</span> <span class="o">=</span> <span class="kc">True</span></div>

    <span class="c1"># NON-PYNN API CALL</span>
<div class="viewcode-block" id="PyNNPopulationCommon.set_mapping_constraint"><a class="viewcode-back" href="../../../../spynnaker.pyNN.models.html#spynnaker.pyNN.models.pynn_population_common.PyNNPopulationCommon.set_mapping_constraint">[docs]</a>    <span class="k">def</span> <span class="nf">set_mapping_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constraint_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add a placement constraint - for backwards compatibility</span>

<span class="sd">        :param constraint_dict: A dictionary containing &quot;x&quot;, &quot;y&quot; and\</span>
<span class="sd">            optionally &quot;p&quot; as keys, and ints as values</span>
<span class="sd">        :type constraint_dict: dict(str, int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">globals_variables</span><span class="o">.</span><span class="n">get_simulator</span><span class="p">()</span><span class="o">.</span><span class="n">verify_not_running</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_placement_constraint</span><span class="p">(</span><span class="o">**</span><span class="n">constraint_dict</span><span class="p">)</span>

        <span class="c1"># state that something has changed in the population,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__change_requires_mapping</span> <span class="o">=</span> <span class="kc">True</span></div>

    <span class="c1"># NON-PYNN API CALL</span>
<div class="viewcode-block" id="PyNNPopulationCommon.set_max_atoms_per_core"><a class="viewcode-back" href="../../../../spynnaker.pyNN.models.html#spynnaker.pyNN.models.pynn_population_common.PyNNPopulationCommon.set_max_atoms_per_core">[docs]</a>    <span class="k">def</span> <span class="nf">set_max_atoms_per_core</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_atoms_per_core</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Supports the setting of this population&#39;s max atoms per core</span>

<span class="sd">        :param max_atoms_per_core: the new value for the max atoms per core.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">globals_variables</span><span class="o">.</span><span class="n">get_simulator</span><span class="p">()</span><span class="o">.</span><span class="n">verify_not_running</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span>
            <span class="n">MaxVertexAtomsConstraint</span><span class="p">(</span><span class="n">max_atoms_per_core</span><span class="p">))</span>
        <span class="c1"># state that something has changed in the population</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__change_requires_mapping</span> <span class="o">=</span> <span class="kc">True</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The number of neurons in the population</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span><span class="o">.</span><span class="n">n_atoms</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_get_vertex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_internal_delay_vertex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__delay_vertex</span>

    <span class="nd">@_internal_delay_vertex</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">_internal_delay_vertex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delay_vertex</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__delay_vertex</span> <span class="o">=</span> <span class="n">delay_vertex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__change_requires_mapping</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_get_variable_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Helper method for getting units from a parameter used by the vertex</span>

<span class="sd">        :param parameter_name: the parameter name to find the units for</span>
<span class="sd">        :return: the units in string form</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vertex_contains_units</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__vertex</span><span class="o">.</span><span class="n">get_units</span><span class="p">(</span><span class="n">parameter_name</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
            <span class="s2">&quot;This population does not support describing its units&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_roundsize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">size</span>
        <span class="c1"># External device population can have a size of None so accept for now</span>
        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="c1"># Allow a float which has a near int value</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">temp</span> <span class="o">-</span> <span class="n">size</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Size of the population rounded &quot;</span>
                           <span class="s2">&quot;from </span><span class="si">{}</span><span class="s2"> to </span><span class="si">{}</span><span class="s2">. Please use int values for size&quot;</span><span class="p">,</span>
                           <span class="n">label</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">temp</span>
        <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
            <span class="s2">&quot;Size of a population with label </span><span class="si">{}</span><span class="s2"> must be an int,&quot;</span>
            <span class="s2">&quot; received </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">sPyNNaker  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2014-2017.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.3.
    </div>
  </body>
</html>